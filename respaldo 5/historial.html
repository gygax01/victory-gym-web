<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>Historial</title>
<link rel="stylesheet" href="css/styles.css">
</head>

<body>
<header class="header-brand">
  <div class="brand"><img src="img/logo.png"><h2>Historial de clientes</h2></div>
  <button onclick="location.href='index.html'">‚Üê Inicio</button>
</header>

<div class="search-bar"><input id="busqueda" placeholder="Buscar cliente..."></div>
<div class="historial-container" id="listaHistorial"></div>

<script src="js/storage.js"></script>
<script src="js/auth.js"></script>

<script>
const listaHistorial=document.getElementById("listaHistorial");
const busqueda=document.getElementById("busqueda");
let clientes=[],asistencias=[];

window.addEventListener("load",initHistorial);
function initHistorial(){
  if(!verificarSesion())return;
  if(!requirePermission("history_view"))return;
  busqueda.addEventListener("input",filtrar);
  cargarHistorial();
}

function cargarHistorial(){
  clientes=obtenerClientes().filter(c=>c&&typeof c.nombre==="string");
  asistencias=obtenerAsistencias();
  render(clientes);
}

function render(lista){
  listaHistorial.innerHTML="";
  if(!lista.length){listaHistorial.textContent="No hay historial disponible";return;}
  lista.forEach(c=>{
    const card=document.createElement("div");card.className="cliente";
    card.innerHTML=`<h3>${c.nombre}</h3>`;
    listaHistorial.appendChild(card);
  });
}

function filtrar(){
  const q=busqueda.value.toLowerCase();
  render(clientes.filter(c=>c.nombre.toLowerCase().includes(q)));
}
</script>
</body>
</html>
